# 版本信息管理功能说明

## 功能概述

本功能实现了将应用版本信息自动存储到数据库中，包括版本名称、版本代码、安装时间和最后更新时间等信息。

## 实现组件

### 1. VersionManager 工具类

位置：`app/src/main/java/com/example/fourquadrant/utils/VersionManager.java`

**主要功能：**
- 获取当前应用版本信息
- 检查版本更新
- 将版本信息存储到数据库
- 提供版本信息查询接口

**核心方法：**
- `checkAndUpdateVersion()`: 检查并更新版本信息
- `getCurrentVersionName()`: 获取当前版本名称
- `getCurrentVersionCode()`: 获取当前版本代码
- `getInstallTime()`: 获取安装时间
- `getLastUpdateTime()`: 获取最后更新时间
- `isFirstInstall()`: 检查是否首次安装
- `isVersionUpdated()`: 检查是否版本更新

### 2. 数据库存储

**存储位置：** `settings` 表

**存储字段：**
- `app_version_name`: 应用版本名称 (STRING)
- `app_version_code`: 应用版本代码 (INT)
- `app_install_time`: 应用安装时间 (LONG)
- `app_last_update_time`: 最后更新时间 (LONG)

### 3. 数据库初始化

**位置：** `SettingsDao.java` 中的 `insertDefaultSettings` 方法

**默认值：**
```sql
('app_version_name', '1.0', 'STRING', 'APP', :time, :time),
('app_version_code', '1', 'INT', 'APP', :time, :time),
('app_install_time', :time, 'LONG', 'APP', :time, :time)
```

### 4. 应用集成

**位置：** `FourQuadrantApplication.java`

**集成方式：**
- 在应用启动时自动初始化 `VersionManager`
- 在数据库初始化完成后调用版本检查
- 使用后台线程执行版本信息更新

## 使用方法

### 获取版本信息

```java
// 获取 VersionManager 实例
FourQuadrantApplication app = (FourQuadrantApplication) getApplication();
VersionManager versionManager = app.getVersionManager();

// 获取版本信息
String currentVersion = versionManager.getCurrentVersionName();
int currentVersionCode = versionManager.getCurrentVersionCode();
long installTime = versionManager.getInstallTime();
boolean isFirstInstall = versionManager.isFirstInstall();
```

### 手动触发版本检查

```java
versionManager.checkAndUpdateVersion();
```

## 日志输出

应用启动时会在 `MainActivity` 中输出详细的版本信息验证日志：

```
D/VersionInfo: === 版本信息验证 ===
D/VersionInfo: 当前版本名称: 1.0
D/VersionInfo: 当前版本代码: 1
D/VersionInfo: 存储的版本名称: 1.0
D/VersionInfo: 存储的版本代码: 1
D/VersionInfo: 安装时间: Mon Jan 01 12:00:00 GMT+08:00 2024
D/VersionInfo: 最后更新时间: Mon Jan 01 12:00:00 GMT+08:00 2024
D/VersionInfo: 是否首次安装: false
D/VersionInfo: 是否版本更新: false
D/VersionInfo: 版本摘要: 版本 1.0 (代码: 1)
D/VersionInfo: === 版本信息验证完成 ===
```

## 版本更新处理

当应用版本发生变化时，系统会自动：

1. 更新存储的版本名称和版本代码
2. 记录最后更新时间
3. 输出版本更新日志
4. 保持原有的安装时间不变

## 数据库扩展

如需添加更多版本相关信息，可以：

1. 在 `VersionManager` 中添加新的常量和方法
2. 在 `SettingsDao.insertDefaultSettings` 中添加新的默认值
3. 在 `SettingsRepository` 中添加对应的存取方法

## 注意事项

1. 版本信息检查在后台线程中执行，避免阻塞主线程
2. 首次安装时会记录安装时间，后续版本更新不会修改安装时间
3. 所有版本信息都存储在 `APP` 分类下
4. 异常处理确保版本信息功能不会影响应用正常运行