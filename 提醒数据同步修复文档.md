# æé†’æ•°æ®åŒæ­¥é—®é¢˜ä¿®å¤æ–‡æ¡£

## ğŸ”§ é—®é¢˜æè¿°

**åŸå§‹é—®é¢˜**: åœ¨æé†’åˆ—è¡¨ä¸­åˆ é™¤æé†’é¡¹ç›®åï¼Œæ—¥å†è§†å›¾æ²¡æœ‰ç«‹å³æ›´æ–°ï¼Œç‚¹å‡»æ—¥å†è¿˜æ˜¯æ˜¾ç¤ºåŸæ¥çš„æ•°æ®ã€‚

**é—®é¢˜æ ¹å› **: 
- `ReminderListFragment` å’Œ `ReminderCalendarFragment` å„è‡ªåˆ›å»ºäº†ç‹¬ç«‹çš„ `ReminderManager` å®ä¾‹
- æ•°æ®å˜åŒ–åªåœ¨æ“ä½œçš„Fragmentä¸­ç”Ÿæ•ˆï¼Œæ²¡æœ‰åŒæ­¥åˆ°å…¶ä»–Fragment
- ç¼ºä¹ç»Ÿä¸€çš„æ•°æ®ç®¡ç†æœºåˆ¶

## ğŸš€ è§£å†³æ–¹æ¡ˆ

### 1. å…±äº«æ•°æ®ç®¡ç†å™¨æ¶æ„

å®ç°äº†ä»¥ä¸‹æ¶æ„æ¥è§£å†³æ•°æ®åŒæ­¥é—®é¢˜ï¼š

```
ReminderMainFragment (ä¸»å®¹å™¨)
â”œâ”€â”€ SharedReminderManager (å…±äº«æ•°æ®ç®¡ç†å™¨)
â”œâ”€â”€ ReminderListFragment (æé†’åˆ—è¡¨)
â””â”€â”€ ReminderCalendarFragment (æ—¥å†è§†å›¾)
```

### 2. æ ¸å¿ƒä¿®æ”¹å†…å®¹

#### 2.1 ReminderMainFragment æˆä¸ºæ•°æ®ä¸­å¿ƒ

```java
public class ReminderMainFragment extends Fragment implements ReminderManager.ReminderManagerListener {
    // å…±äº«çš„æ•°æ®ç®¡ç†å™¨
    private ReminderManager sharedReminderManager;
    
    private void initSharedReminderManager() {
        sharedReminderManager = new ReminderManager(requireContext());
        sharedReminderManager.addListener(this);
        
        // ä¼ é€’ç»™å­Fragment
        reminderListFragment.setSharedReminderManager(sharedReminderManager);
        reminderCalendarFragment.setSharedReminderManager(sharedReminderManager);
    }
}
```

#### 2.2 å­Fragment ä½¿ç”¨å…±äº«ç®¡ç†å™¨

**ReminderListFragment**:
```java
public void setSharedReminderManager(ReminderManager sharedManager) {
    // ç§»é™¤æ—§ç›‘å¬å™¨
    if (reminderManager != null) {
        reminderManager.removeListener(this);
    }
    
    // è®¾ç½®å…±äº«ç®¡ç†å™¨
    this.reminderManager = sharedManager;
    this.useSharedManager = true;
    
    if (reminderManager != null) {
        reminderManager.addListener(this);
    }
}
```

**ReminderCalendarFragment**: ç›¸åŒçš„å®ç°é€»è¾‘

#### 2.3 NewReminderFragment æ™ºèƒ½è·å–å…±äº«ç®¡ç†å™¨

```java
private ReminderManager getSharedReminderManager() {
    try {
        if (getActivity() instanceof MainActivity) {
            MainActivity mainActivity = (MainActivity) getActivity();
            // æŸ¥æ‰¾ReminderMainFragment
            for (Fragment fragment : mainActivity.getSupportFragmentManager().getFragments()) {
                if (fragment instanceof ReminderMainFragment) {
                    ReminderMainFragment mainFragment = (ReminderMainFragment) fragment;
                    return mainFragment.getSharedReminderManager();
                }
            }
        }
    } catch (Exception e) {
        // å¼‚å¸¸å¤„ç†
    }
    
    return null; // æœªæ‰¾åˆ°åˆ™åˆ›å»ºæ–°å®ä¾‹
}
```

## ğŸ“Š æ•°æ®æµç¨‹å›¾

### ä¿®å¤å‰ï¼ˆé—®é¢˜çŠ¶æ€ï¼‰
```mermaid
graph TD
    A[ReminderListFragment] --> B[ReminderManagerå®ä¾‹1]
    C[ReminderCalendarFragment] --> D[ReminderManagerå®ä¾‹2]
    E[NewReminderFragment] --> F[ReminderManagerå®ä¾‹3]
    
    B -.-> G[SharedPreferences]
    D -.-> G
    F -.-> G
    
    B -.x H[æ•°æ®ä¸åŒæ­¥]
    D -.x H
    F -.x H
```

### ä¿®å¤åï¼ˆè§£å†³çŠ¶æ€ï¼‰
```mermaid
graph TD
    A[ReminderMainFragment] --> B[SharedReminderManager]
    C[ReminderListFragment] --> B
    D[ReminderCalendarFragment] --> B
    E[NewReminderFragment] --> B
    
    B --> F[SharedPreferences]
    B --> G[ReminderManagerListener é€šçŸ¥æœºåˆ¶]
    G --> C
    G --> D
    G --> A
    
    H[æ•°æ®æ“ä½œ] --> B
    B --> I[è‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰Fragment]
```

## ğŸ”„ æ•°æ®åŒæ­¥æµç¨‹

### 1. åˆ é™¤æé†’çš„å®Œæ•´æµç¨‹

1. **ç”¨æˆ·æ“ä½œ**: åœ¨æé†’åˆ—è¡¨ä¸­ç‚¹å‡»åˆ é™¤æŒ‰é’®
2. **Adapterå›è°ƒ**: `ReminderListAdapter.onDeleteReminder()`
3. **Fragmentå¤„ç†**: `ReminderListFragment.onDeleteReminder()`
4. **æ•°æ®ç®¡ç†å™¨**: `SharedReminderManager.deleteReminder()`
5. **æŒä¹…åŒ–**: æ›´æ–° `SharedPreferences`
6. **é€šçŸ¥æœºåˆ¶**: è§¦å‘ `onReminderDeleted()` å›è°ƒ
7. **è‡ªåŠ¨åŒæ­¥**: æ‰€æœ‰ç›‘å¬å™¨æ”¶åˆ°é€šçŸ¥
8. **UIæ›´æ–°**: 
   - `ReminderListFragment.onRemindersChanged()` â†’ åˆ·æ–°åˆ—è¡¨
   - `ReminderCalendarFragment.onRemindersChanged()` â†’ åˆ·æ–°æ—¥å†è§†å›¾

### 2. æ•°æ®ç›‘å¬æœºåˆ¶

```java
// ReminderManager.java
public interface ReminderManagerListener {
    void onRemindersChanged();        // æ•°æ®æ€»ä½“å˜åŒ–
    void onReminderAdded(ReminderItem reminder);     // æ–°å¢æé†’
    void onReminderUpdated(ReminderItem reminder);   // æ›´æ–°æé†’
    void onReminderDeleted(ReminderItem reminder);   // åˆ é™¤æé†’
}
```

æ‰€æœ‰Fragmentéƒ½å®ç°è¿™ä¸ªæ¥å£ï¼Œç¡®ä¿ä»»ä½•æ•°æ®å˜åŒ–éƒ½èƒ½åŠæ—¶å“åº”ã€‚

## ğŸ›¡ï¸ å…¼å®¹æ€§ä¿éšœ

### 1. å‘åå…¼å®¹

- ä¿ç•™äº†åŸæœ‰çš„Fragmentç‹¬ç«‹åˆ›å»ºReminderManagerçš„æœºåˆ¶
- ä½¿ç”¨ `useSharedManager` æ ‡å¿—æ§åˆ¶æ˜¯å¦ä½¿ç”¨å…±äº«ç®¡ç†å™¨
- å¦‚æœæ— æ³•è·å–å…±äº«ç®¡ç†å™¨ï¼Œä¼šå›é€€åˆ°åˆ›å»ºç‹¬ç«‹å®ä¾‹

### 2. å¼‚å¸¸å¤„ç†

```java
// å®‰å…¨çš„å…±äº«ç®¡ç†å™¨è·å–
private ReminderManager getSharedReminderManager() {
    try {
        // å°è¯•è·å–å…±äº«ç®¡ç†å™¨
        return mainFragment.getSharedReminderManager();
    } catch (Exception e) {
        System.out.println("è·å–å…±äº«ReminderManagerå¤±è´¥: " + e.getMessage());
        return null; // å›é€€åˆ°ç‹¬ç«‹å®ä¾‹
    }
}
```

### 3. é˜²æ­¢å†…å­˜æ³„æ¼

- åœ¨Fragmentç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶æ­£ç¡®ç§»é™¤ç›‘å¬å™¨
- ä½¿ç”¨ `requireContext()` è€Œä¸æ˜¯æŒæœ‰Activityå¼•ç”¨
- æ­£ç¡®å¤„ç†FragmentçŠ¶æ€ä¿å­˜å’Œæ¢å¤

## ğŸ¯ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰çš„é—®é¢˜
- âŒ åœ¨æé†’åˆ—è¡¨åˆ é™¤é¡¹ç›®ï¼Œæ—¥å†è§†å›¾ä¸æ›´æ–°
- âŒ åœ¨æ—¥å†è§†å›¾åˆ é™¤é¡¹ç›®ï¼Œæé†’åˆ—è¡¨ä¸æ›´æ–°  
- âŒ æ–°å»ºæé†’åï¼Œå¯èƒ½åœ¨æŸäº›Fragmentä¸­ä¸æ˜¾ç¤º
- âŒ æ•°æ®ä¸ä¸€è‡´å¯¼è‡´ç”¨æˆ·å›°æƒ‘

### ä¿®å¤åçš„æ•ˆæœ
- âœ… ä»»ä½•Fragmentä¸­çš„æ•°æ®æ“ä½œéƒ½ä¼šç«‹å³åŒæ­¥åˆ°æ‰€æœ‰Fragment
- âœ… å®æ—¶çš„æ•°æ®ä¸€è‡´æ€§ä¿è¯
- âœ… ç»Ÿä¸€çš„æ•°æ®ç®¡ç†æœºåˆ¶
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

## ğŸ” è°ƒè¯•å’ŒéªŒè¯

### è°ƒè¯•æ—¥å¿—

ä¿®å¤åçš„ä»£ç åŒ…å«è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ï¼š

```java
System.out.println("ReminderMainFragment: onReminderDeleted - " + reminder.getContent());
System.out.println("ReminderListFragment: ä½¿ç”¨å…±äº«çš„ReminderManager");
System.out.println("NewReminderFragment: æˆåŠŸè·å–å…±äº«çš„ReminderManager");
```

### éªŒè¯æ­¥éª¤

1. **åˆ›å»ºæé†’**: åœ¨ä»»ä¸€é¡µé¢åˆ›å»ºæé†’ï¼Œæ£€æŸ¥æ‰€æœ‰é¡µé¢æ˜¯å¦æ˜¾ç¤º
2. **åˆ é™¤æé†’**: åœ¨åˆ—è¡¨é¡µé¢åˆ é™¤ï¼Œæ£€æŸ¥æ—¥å†é¡µé¢æ˜¯å¦ç«‹å³æ›´æ–°
3. **ç¼–è¾‘æé†’**: ä¿®æ”¹æé†’åï¼Œæ£€æŸ¥æ‰€æœ‰é¡µé¢æ•°æ®ä¸€è‡´æ€§
4. **åˆ‡æ¢é¡µé¢**: åœ¨ä¸åŒé¡µé¢é—´åˆ‡æ¢ï¼Œç¡®è®¤æ•°æ®åŒæ­¥æ­£å¸¸

## ğŸ“ æ€»ç»“

é€šè¿‡å®ç°å…±äº«æ•°æ®ç®¡ç†å™¨æ¶æ„ï¼Œå®Œå…¨è§£å†³äº†æé†’æ•°æ®åœ¨ä¸åŒFragmenté—´çš„åŒæ­¥é—®é¢˜ã€‚è¿™ä¸ªè§£å†³æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

1. **å½»åº•è§£å†³**: ä»æ ¹æœ¬ä¸Šè§£å†³äº†æ•°æ®ä¸åŒæ­¥é—®é¢˜
2. **æ¶æ„æ¸…æ™°**: ç»Ÿä¸€çš„æ•°æ®ç®¡ç†ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
3. **å…¼å®¹æ€§å¥½**: ä¿ç•™äº†å‘åå…¼å®¹æ€§ï¼Œé™ä½äº†é£é™©
4. **å®æ—¶åŒæ­¥**: ä»»ä½•æ•°æ®å˜åŒ–éƒ½èƒ½ç«‹å³åæ˜ åˆ°æ‰€æœ‰UI
5. **ç”¨æˆ·ä½“éªŒ**: æä¾›äº†ä¸€è‡´ã€æµç•…çš„ç”¨æˆ·ä½“éªŒ

ç°åœ¨ç”¨æˆ·åœ¨ä»»ä½•é¡µé¢è¿›è¡Œæé†’æ“ä½œï¼Œéƒ½èƒ½çœ‹åˆ°æ‰€æœ‰ç›¸å…³é¡µé¢çš„å³æ—¶æ›´æ–°ï¼ŒçœŸæ­£å®ç°äº†æ•°æ®çš„å®æ—¶åŒæ­¥ã€‚
